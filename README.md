# Pooled_Testing_HIV
 Code used for Pooled Testing in HIV paper

This project contains all of the code used to produce the results in the paper titled "Prediction-Driven Pooled Testing Methods: Application to HIV Treatment Monitoring in Kalisizo, Uganda".

Below are descriptions of programs, documentation and datasets used on this project.

IMPORTANT: the programs will not run as is. Many of the programs refer to/source other programs, so working directories need to be set appropriately to run. Make sure when you copy programs to your system to declare all of the working directories to point to the correct locations. There are comments noting where to set working directories in the programs. Search for 'setwd' to find them. Also, the method_eval programs need a location to write results to. In the 'write.table' statements in those programs, put the file path in the quotations before the name of the result.

Data Dictionary (DD):
  The data dictionary is an Excel workbook with a separate sheet for the datasets included in this repository. The dictionary for each dataset contains a row for each variable in that dataset and the source for the variable. If it is a derived variable it also includes the derivation for that variable. The datasets include the simulation datasets used in Section 4 as well as the raw, intermediate and final datasets containing real-world data from Uganda used in Section 5. The raw dataset from Uganda is not included in the repository.

Programs:
  raw_data_clean.R: this program reads in the raw data from Uganda, cleans the variables and adds some derived variables as described in the DD.

  training_set.R: takes the cleaned Uganda data generated by raw_data_clean, transforms it into long format, filters out records by time (those prior to June 30th, 2010) and adds variables as described in the DD.

  test_set: does the same as training_set, but filters for all records after June 30th, 2010.

  data_gen.R: generates 6 simulated datasets used in Section 4 of the paper as described in the DD.

  method_eval_source.R: this program contains code for all of the functions needed for the method evaluation, and must be sourced before running the code to evaluate the methods.

  Method_eval folder programs: there are 4 programs in this folder - each one evaluates the methods in different scenarios.

    method_eval3_run2.R - reads in the simulated data with SD=1.0 and evaluates the methods (minus Hypred) in 16 scenarios (not all presented in the paper)

    method_eval4_run2.R - same as method_eval3_run2.R, but using he data with SD=0

    method_run2_hypred.R - evaluates the HyPred method in the same scenarios as method_eval3_run2.R and method_eval4_run2.R does for the other methods. In order to make sure the same data is used, I extracted the 50,000 records used in the 500 matrices for the other methods, and applied them to the HyPred method to ensure they used the same records. That data is saved here Pooled_Testing_HIV\SimData\Records_used_in_500_matrices_hypred

    method_run2_uganda.R - evaluates the methods using the data from Uganda in a variety of measurement errors.

  model_pred.R - applies a variety of regression techniques for prediction on the training set of the uganda data. We ended up using ridge regression modelling single failure.

  sim_data_betas.R - applies regression techniques on the simulated training sets of 5,000 records each to get estimated betas to use in the method evaluation of the simulated data.

  uganda_eval_data.R - uses the predictive model obtained by model_pred.R to predict the VLs in the test_set for the uganda data, and puts the test_set data into format to use in the method evaluation.

  results_anal.R -compiles the results of the method evaluation for the simulations (minus HyPred) and puts them into tables; also outputs latex code for the summary tables.

  results_anal_hypred.R - does the same as results_anal.R, but for the HyPred method using the simulated dataset

  results_anal_uganda.R - does the same as results_anal.R but for all methods using the real uganda data.
